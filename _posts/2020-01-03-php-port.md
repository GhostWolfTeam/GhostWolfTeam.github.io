---
layout: post
title:  "使用PHP实现在线端口扫描"
categories: PHP
tags: PHP 端口扫描 前端 在线
author: 烨
---



* content
{:toc}








PHP4/5/7版本中提供了fsockopen方法，该方法用于打开一个网络连接或者一个Unix套接字连接，也可以用来进行开放端口扫描。  
下面是PHP官方对于fsockopen方法的说明：  
![](https://s2.ax1x.com/2020/01/03/lUyHeK.png)  
使用fsockopen()方法我们可以设计以下思路来实现开放端口检测:  
> - 1.获取目标IP地址以及待扫描的端口列表。  
> - 2.使用For循环遍历带扫描的端口数组，讲目标IP地址与端口进行拼接。  
> - 3.使用fsockopen()函数进行探测：通过Timeout参数进行判断：若超过1s无响应则视作端口未开放。  
> - 4.考虑到端口扫描功能的特殊性，可能会存在SSRF漏洞，因此需要对SSRF漏洞进行防护。  

开放端口扫描实现出的代码如下：  
```PHP4
function getOpenPort($ip,$port){
    $msg = array('Ftp','Telnet','Smtp','Finger','Http','Pop3','Location Service','Netbios-NS','Netbios-DGM','Netbios-SSN','IMAP','Https','Microsoft-DS','MSSQL','MYSQL');
    foreach ($port as $key => $value){
        echo $value.'&nbsp&nbsp';
        echo $msg[$key].'&nbsp&nbsp';
        $fp = @fsockopen($ip,$value,$errno,$errstr,0.5);
        $result = $fp ? '<font color="#43CD80"><开启></font><br>' : '<font color="#FF6347"><关闭></font><br>';
        echo $result;
```
